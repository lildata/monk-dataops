namespace: /apache-spark

master:
  defines: runnable
  containers:
    defines: containers
    spark:
      image: docker.io/bitnami/spark:3-debian-10
      ports:
        - 0.0.0.0:8080:8080
        - 0.0.0.0:7077:7077
      environment:
        - SPARK_MODE=master
        - SPARK_RPC_AUTHENTICATION_ENABLED=no
        - SPARK_RPC_ENCRYPTION_ENABLED=no
        - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
        - SPARK_SSL_ENABLED=no
        - <- `SPARK_MASTER_HOST=${spark-master-host}`
        - SPARK_MASTER_PORT=7077
  variables:
    defines: variables
    spark-master-host:
      type: string
      value: <- get-hostname("apache-spark/master", "spark")

worker-1:
  defines: runnable
  containers:
    defines: containers
    spark:
      image: docker.io/bitnami/spark:3-debian-10
      environment:
        - SPARK_MODE=worker
        - <- `SPARK_MASTER_URL=${spark-master-url}`
        - SPARK_WORKER_MEMORY=1G
        - SPARK_WORKER_CORES=1
        - SPARK_RPC_AUTHENTICATION_ENABLED=no
        - SPARK_RPC_ENCRYPTION_ENABLED=no
        - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
        - SPARK_SSL_ENABLED=no
  variables:
    defines: variables
    spark-master-host:
      type: string
      value: <- get-hostname("apache-spark/master", "spark")
    spark-master-url:
      type: string
      # value: <- `spark://34.90.96.190:7077`
      value: <- `spark://${spark-master-host}:7077`
